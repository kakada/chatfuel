= render "shared/page_header", title: "Dictionary", link: link_to_new('dictionary')

.row
  .col-3
    %div{ style: "height: 520px; overflow-y: scroll"}
      #v-pills-tab.nav.flex-column.nav-pills
        - @variables.select("name").distinct.each_with_index do |v, index|
          = link_to v.name, "#v-pills-#{v.name}", class: "nav-link #{toggle_class_name("active", index.zero?)}", "data-toggle" => "pill"
  .col-9
    #v-pills-tabContent.tab-content
      - @variables.each_with_index do |v, index|
        .tab-pane.fade{ id: "v-pills-#{v.name}", class: "#{toggle_class_name("active show", index.zero?)}" }
          = simple_form_for :dictionaries, url: batch_update_dictionaries_path, method: :put, html: { class: 'form-inline'}, remote: false do |f|
            .card
              .card-body
                %table.table{ class: "dict-item-#{v.name}" }
                  %tr
                    %th Raw value
                    %th Mapping value
                    - if v.report_enabled?
                      %th Satisfied
                  - @variables.order(value: :asc).each do |sub|
                    - if sub.name == v.name
                      %tr
                        %td
                          = f.input :id, as: :hidden, input_html: { value: sub.id, name: "variable[][id]" }
                          .input-group
                            .input-group-prepend
                              .input-group-text
                                = link_to "X", dictionary_path(sub), method: :delete, data: { disable_with: "wait...", confirm: "Are you sure?" }, remote: true
                            = f.input_field :value, value: sub.value, name: "variable[][value]", id: "variable_value_#{sub.id}", class: 'form-control string required mr-sm-2', label: false
                        %td  
                          = f.input :text, input_html: { value: sub.text, name: "variable[][text]", id: "variable_text_#{sub.id}", class: 'mr-sm-2' }, label: false
                        - if sub.report_enabled?
                          %td
                            = f.radio_button :status, 1, name: "variable[][status]", checked: sub.satisfied?

                  %tr
                    %td{ colspan: 2 }
                      = link_to "+ Add pair", "#", class: "btn btn-add", "data-name": v.name
                    %td
                      = f.submit "Update", class: "btn btn-primary pull-right"
.clearfix
