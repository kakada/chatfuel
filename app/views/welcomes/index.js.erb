window.gon = JSON.parse('<%= j(@gon_data.to_json.html_safe) %>');

<% @context.each do |ctx|%>
  $('<%= ctx[:dom] %>').<%= ctx[:action] %>('<%= j render("#{ctx[:path]}/#{ctx[:template]}") %>');
<% end %>

$('#provincesModal').replaceWith('<%= j render("welcomes/province_modal") %>');
$('#districtsModal').replaceWith('<%= j render("welcomes/district_modal") %>');
pumi.setup();

// whenever form submitted, refresh sibling
// so when sibling is clicked, it reload(ajax) the result
$(".nav-link[href!='<%= @active_tab %>']").data("status", "fresh");

$("#sub_categories_modals").html("<%= j render(partial: "dashboard/sub_categories_modals", collection: @query.province_codes_without_other, as: :province_id) %>");
$("#feedback_trend_modals").html("<%= j render(partial: "dashboard/feedback_trend_modals", collection: @query.province_codes_without_other, as: :province_id) %>");

OWSO.WelcomesIndex.scrollToForm();
OWSO.WelcomesIndex.onWindowScroll();
OWSO.WelcomesIndex.onDistrictModalSave();
OWSO.WelcomesIndex.onProvinceModalSave();
OWSO.DashboardShow.renderDatetimepicker();
OWSO.DashboardShow.runAsPublicDashboard();
OWSO.DashboardShow.multiSelectDistricts();

var options = JSON.parse('<%= j(@query.options.to_json.html_safe) %>');

$(document).on('click', '.btn-province-save', function() {
  OWSO.WelcomesIndex.provinceClickHandler();
});

$(document).on('click', '.btn-district-save', function() {
  OWSO.WelcomesIndex.districtClickHandler();
});

setTimeout(function() {
  $('.province_code').val(options.province_id).trigger("change");
  $(".btn-province-save").trigger("click");

  setTimeout(function() {
    $('.district_code').val(options.district_id).trigger("change");
    $(".btn-district-save").trigger("click");
  }, 1000)
}, 2000)
